function Ane(){this.rootx=[];this.headx=[];this.heady=[];this.angle;this.amp=[];this.init()}Ane.prototype.num=50;Ane.prototype.init=function(){this.rootx[0]=10;this.angle=0;for(var i=1;i<this.num;i++){this.rootx[i]=this.rootx[i-1]+Math.random()*32;this.heady[i]=cavHeight-200+Math.random()*60;this.headx[i]=this.rootx[i];this.amp[i]=Math.random()*50+10}}Ane.prototype.drawAne=function(){ctx2.save();ctx2.strokeStyle="#3b154e";ctx2.lineWidth="20";ctx2.lineCap="round";ctx2.globalAlpha=0.6;for(var i=0;i<this.num;i++){ctx2.beginPath();ctx2.moveTo(this.rootx[i],cavHeight);this.angle+=deltaTime*0.00002;var alpha=Math.sin(this.angle);this.headx[i]=this.rootx[i]+this.amp[i]*alpha;ctx2.quadraticCurveTo(this.rootx[i],cavHeight-40,this.headx[i],this.heady[i]);ctx2.stroke()}ctx2.restore()};function Baby(){this.x;this.y;this.angle;this.babyEye=[];this.babyEyeTimer=0;this.babyEyeCount=0;this.babyEyeInterval=1;this.babyBody=[];this.babyBodyTimer=0;this.babyBodyCount=0;this.babyTail=[];this.babyTailTimer=0;this.babyTailCount=0}Baby.prototype.init=function(){this.x=cavWidth/2-50;this.y=cavHeight/2+50;this.angle=0;for(var i=0;i<8;i++){this.babyTail[i]=new Image();this.babyTail[i].src="src/babyTail"+i+".png"}for(var i=0;i<2;i++){this.babyEye[i]=new Image();this.babyEye[i].src="src/babyEye"+i+".png"}for(var i=0;i<20;i++){this.babyBody[i]=new Image();this.babyBody[i].src="src/babyFade"+i+".png"}}Baby.prototype.draw=function(){this.x=lerpDistance(mom.x+30,this.x,0.98);this.y=lerpDistance(mom.y+30,this.y,0.98);var deltay=mom.y-this.y;var deltax=mom.x-this.x;var beta=Math.atan2(deltay,deltax)+Math.PI;this.angle=lerpAngle(beta,this.angle,0.7);this.babyTailTimer+=deltaTime;if(this.babyTailTimer>50){this.babyTailCount++;this.babyTailTimer=this.babyTailTimer%50;this.babyTailCount=this.babyTailCount%8}this.babyEyeTimer+=deltaTime;if(this.babyEyeTimer>this.babyEyeInterval){this.babyEyeCount++;this.babyEyeCount=this.babyEyeCount%2;this.babyEyeTimer=this.babyEyeTimer%this.babyEyeInterval}if(this.babyEyeCount==0){this.babyEyeInterval=2000+Math.random()*1500}else{this.babyEyeInterval=200}this.babyBodyTimer+=deltaTime;if(this.babyBodyTimer>300){this.babyBodyCount++;this.babyBodyTimer=this.babyBodyTimer%300;if(this.babyBodyCount>19){this.babyBodyCount=19;data.gameover=true}}ctx1.save();ctx1.translate(this.x,this.y);ctx1.rotate(this.angle);ctx1.drawImage(this.babyBody[this.babyBodyCount],-this.babyBody[this.babyBodyCount].width*0.5,-this.babyBody[this.babyBodyCount].height*0.5);ctx1.drawImage(this.babyEye[this.babyEyeCount],-this.babyEye[this.babyEyeCount].width*0.5,-this.babyEye[this.babyEyeCount].height*0.5);ctx1.drawImage(this.babyTail[this.babyTailCount],-this.babyTail[this.babyTailCount].width*0.5+25,-this.babyTail[this.babyTailCount].height*0.5);ctx1.restore()}function momFruitsCollision(){if(!data.gameover){for(var i=0;i<fruit.num;i++){if(fruit.active[i]){var length=calLength2(fruit.x[i],fruit.y[i],mom.x,mom.y);if(length<900){fruit.dead(i);data.fruitData++;mom.bigBodyCount++;if(mom.bigBodyCount>7){mom.bigBodyCount=7}if(fruit.type4fruit[i]=="blue"){data.double++}wave.born(fruit.x[i],fruit.y[i])}}}}}function momBabyCollision(){if(!data.gameover){var length=calLength2(baby.x,baby.y,mom.x,mom.y);if(length<900){if(mom.bigBodyCount>0){halo.born(baby.x,baby.y);data.addScore();baby.babyBodyCount=0;mom.bigBodyCount=0}}}}function Dust(){this.x=[];this.y=[];this.type4shape=[];this.angle;this.amp=[]}Dust.prototype.images=[];Dust.prototype.num=30;Dust.prototype.init=function(){this.angle=0;for(var i=0;i<7;i++){this.images[i]=new Image();this.images[i].src="src/dust"+i+".png"}for(var i=0;i<this.num;i++){this.x[i]=Math.random()*cavWidth;this.y[i]=Math.random()*cavHeight;this.type4shape[i]=Math.floor(Math.random()*7);this.amp=Math.random()*20+10}}Dust.prototype.draw=function(){for(var i=0;i<this.num;i++){this.angle+=deltaTime*0.00002;var alpha=Math.sin(this.angle);console.log()ctx1.drawImage(this.images[this.type4shape[i]],this.x[i]+alpha*this.amp,this.y[i])}};function Data(){this.fruitData=0;this.double=1;this.score=0;this.gameover=false;this.alpha=0}Data.prototype.draw=function(){ctx1.save();ctx1.fillStyle="#fff";ctx1.shadowBlur=5;ctx1.shadowColor="#fff";ctx1.font="20px Georgia";ctx1.textAlign="center";ctx1.fillText("Score:"+this.score,cavWidth*0.5,cavHeight-30);if(this.gameover){ctx1.font="30px Georgia";this.alpha+=deltaTime*0.0005;ctx1.fillStyle="rgba(255,255,255,"+this.alpha+")";ctx1.fillText("GAMEOVER",cavWidth*0.5,cavHeight*0.5)}ctx1.restore()}Data.prototype.addScore=function(){this.score+=this.fruitData*this.double*100;this.fruitData=0;this.double=1}window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){return window.setTimeout(callback,1000/60)}})();function calLength2(x1,y1,x2,y2){return Math.pow(x1-x2,2)+Math.pow(y1-y2,2)}function randomColor(){var col=[0,1,2];col[0]=Math.random()*100+155;col[0]=col[0].toFixed();col[1]=Math.random()*100+155;col[1]=col[1].toFixed();col[2]=Math.random()*100+155;col[2]=col[2].toFixed();var num=Math.floor(Math.random()*3);col[num]=0;return"rgba("+col[0]+","+col[1]+","+col[2]+","}function lerpAngle(a,b,t){var d=b-a;if(d>Math.PI)d=d-2*Math.PI;if(d<-Math.PI)d=d+2*Math.PI;return a+d*t}function lerpDistance(aim,cur,ratio){var delta=cur-aim;return aim+delta*ratio}function inOboundary(arrX,arrY,l,r,t,b){return arrX>l&&arrX<r&&arrY>t&&arrY<b}function rgbColor(r,g,b){r=Math.round(r*256);g=Math.round(g*256);b=Math.round(b*256);return"rgba("+r+","+g+","+b+",1)"}function rgbNum(r,g,b){r=Math.round(r*256);g=Math.round(g*256);b=Math.round(b*256);return"rgba("+r+","+g+","+b}function rnd(m){var n=m||1;return Math.random()*n}function rateRandom(m,n){var sum=0;for(var i=1;i<(n-m);i++){sum+=i}var ran=Math.random()*sum;for(var i=1;i<(n-m);i++){ran-=i;if(ran<0){return i-1+m}}}function distance(x1,y1,x2,y2,l){var x=Math.abs(x1-x2);var y=Math.abs(y1-y2);if(x<l&&y<l){return true}return false}function AABBbox(object1,w1,h1,object2,w2,h2,overlap){A1=object1.x+overlap;B1=object1.x+w1-overlap;C1=object1.y+overlap;D1=object1.y+h1-overlap;A2=object2.x+overlap;B2=object2.x+w2-overlap;C2=object2.y+overlap;D2=object2.y+h2-overlap;if(A1>B2||B1<A2||C1>D2||D1<C2)return false;else return true}function dis2(x,y,x0,y0){var dx=x-x0;var dy=y-y0;return dx*dx+dy*dy}function rndi2(m,n){var a=Math.random()*(n-m)+m;return Math.floor(a)}function Mom(){this.x;this.y;this.angle;this.bigEye=[];this.bigEyeTimer=0;this.bigEyeCount=0;this.bigEyeInterval=1;this.bigBodyOrg=[];this.bigBodyBlue=[];this.bigBodyTimer=0;this.bigBodyCount=0;this.bigTail=[];this.bigTailTimer=0;this.bigTailCount=0}Mom.prototype.init=function(){this.x=cavWidth/2;this.y=cavHeight/2;this.angle=0;for(var i=0;i<2;i++){this.bigEye[i]=new Image();this.bigEye[i].src="src/bigEye"+i+".png"}for(var i=0;i<8;i++){this.bigBodyOrg[i]=new Image();this.bigBodyBlue[i]=new Image();this.bigBodyOrg[i].src="src/bigEat"+i+".png";this.bigBodyBlue[i].src="src/bigEatBlue"+i+".png"}for(var i=0;i<8;i++){this.bigTail[i]=new Image();this.bigTail[i].src="src/bigTail"+i+".png"}}Mom.prototype.draw=function(){this.x=lerpDistance(mousex,this.x,0.9);this.y=lerpDistance(mousey,this.y,0.9);var deltay=mousey-this.y;var deltax=mousex-this.x;var beta=Math.atan2(deltay,deltax)+Math.PI;this.angle=lerpAngle(beta,this.angle,0.7);this.bigEyeTimer+=deltaTime;if(this.bigEyeTimer>this.bigEyeInterval){this.bigEyeCount++;this.bigEyeCount=this.bigEyeCount%2;this.bigEyeTimer=this.bigEyeTimer%this.bigEyeInterval}if(this.bigEyeCount==0){this.bigEyeInterval=2000+Math.random()*1500}else{this.bigEyeInterval=200}this.bigTailTimer+=deltaTime;if(this.bigTailTimer>50){this.bigTailCount++;this.bigTailTimer=this.bigTailTimer%50;this.bigTailCount=this.bigTailCount%8}ctx1.save();ctx1.translate(this.x,this.y);ctx1.rotate(this.angle);ctx1.drawImage(this.bigEye[this.bigEyeCount],-this.bigEye[this.bigEyeCount].width*0.5,-this.bigEye[this.bigEyeCount].height*0.5);if(data.double==1){ctx1.drawImage(this.bigBodyOrg[this.bigBodyCount],-this.bigBodyOrg[this.bigBodyCount].width*0.5,-this.bigBodyOrg[this.bigBodyCount].height*0.5)}else{ctx1.drawImage(this.bigBodyBlue[this.bigBodyCount],-this.bigBodyBlue[this.bigBodyCount].width*0.5,-this.bigBodyBlue[this.bigBodyCount].height*0.5)}ctx1.drawImage(this.bigTail[this.bigTailCount],-this.bigTail[this.bigTailCount].width*0.5+30,-this.bigTail[this.bigTailCount].height*0.5);ctx1.restore()}function Fruit(){this.active=[];this.x=[];this.y=[];this.l=[];this.spd=[];this.type4fruit=[];this.orange=new Image();this.orange.src="src/fruit.png";this.blue=new Image();this.blue.src="src/blue.png";this.ane=[]}Fruit.prototype.num=30;Fruit.prototype.init=function(){for(var i=0;i<this.num;i++){this.active[i]=false;if(i<15){this.born(i)}}}Fruit.prototype.draw=function(){for(var i=0;i<this.num;i++){if(this.active[i]){if(this.l[i]<14){this.l[i]+=this.spd[i]*deltaTime;this.x[i]=ane.headx[this.ane[i]]-this.l[i]*0.5;ctx2.drawImage(this[this.type4fruit[i]],this.x[i],this.y[i],this.l[i],this.l[i])}else{if(this.y[i]>=0){this.y[i]-=(this.spd[i]*300);ctx2.drawImage(this[this.type4fruit[i]],this.x[i],this.y[i],this.l[i],this.l[i])}else{this.active[i]=false}}}}}Fruit.prototype.born=function(i){var random=Math.floor(Math.random()*50);this.spd[i]=Math.random()*0.02+0.005;this.l[i]=0;this.active[i]=true;this.x[i]=ane.rootx[random]-this.l[i]*0.5;this.y[i]=ane.heady[random]-this.l[i]*0.5;this.ane[i]=random;var random4type=Math.random();if(random4type<0.3){this.type4fruit[i]="blue"}else{this.type4fruit[i]="orange"}}Fruit.prototype.fruitMonitor=function(){var count=0;for(var i=0;i<this.num;i++){if(this.active[i]){count++}}if(count<15){this.sendFruit();return}}Fruit.prototype.sendFruit=function(){for(var i=0;i<this.num;i++){if(!this.active[i]){this.born(i);return}}}Fruit.prototype.dead=function(i){this.active[i]=false}function Halo(){this.x=[];this.y=[];this.r=[];this.alive=[]}Halo.prototype.num=5;Halo.prototype.init=function(){for(var i=0;i<this.num;i++){this.alive[i]=false}}Halo.prototype.born=function(x,y){for(var i=0;i<this.num;i++){if(!this.alive[i]){this.alive[i]=true;this.x[i]=x;this.y[i]=y;this.r[i]=30;return}}}Halo.prototype.draw=function(){ctx1.save();ctx1.shadowColor="#fff";ctx1.lineWidth=2;for(var i=0;i<this.num;i++){if(this.alive[i]){this.r[i]+=deltaTime*0.1;if(this.r[i]>80){this.alive[i]=false;break}var alpha=1-this.r[i]/80;ctx1.beginPath();ctx1.arc(this.x[i],this.y[i],this.r[i],0,2*Math.PI);ctx1.closePath();ctx1.strokeStyle="rgba(255,88,0,"+alpha+")";ctx1.stroke()}}ctx1.restore()}function Wave(){this.x=[];this.y=[];this.r=[];this.alive=[]}Wave.prototype.num=10;Wave.prototype.init=function(){for(var i=0;i<this.num;i++){this.alive[i]=false}}Wave.prototype.born=function(x,y){for(var i=0;i<this.num;i++){if(!this.alive[i]){this.alive[i]=true;this.x[i]=x;this.y[i]=y;this.r[i]=30;return}}}Wave.prototype.draw=function(){ctx1.save();ctx1.shadowColor="#fff";ctx1.shadowBlur=2;ctx1.lineWidth=2;for(var i=0;i<this.num;i++){if(this.alive[i]){this.r[i]+=deltaTime*0.05;if(this.r[i]>60){this.alive[i]=false;break}var alpha=1-this.r[i]/60;ctx1.beginPath();ctx1.arc(this.x[i],this.y[i],this.r[i],0,2*Math.PI);ctx1.closePath();ctx1.strokeStyle="rgba(255,255,255,"+alpha+")";ctx1.stroke()}}ctx1.restore()}var cav1,cav2,ctx1,ctx2,cavWidth,cavHeight,bgImg,ane,fruit,lastTime,deltaTime,mom,mousex,mousey,wave,halo,dust;document.body.onload=game;function game(){lastTime=Date.now();deltaTime=0;init();gameloop()}function init(){cav1=document.getElementById("canvas1"),cav2=document.getElementById("canvas2"),ctx1=cav1.getContext("2d"),ctx2=cav2.getContext("2d"),cavWidth=cav1.width,cavHeight=cav1.height;mousex=cavWidth*0.5;mousey=cavHeight*0.5;cav1.addEventListener('mousemove',onMouseMove);bgImg=new Image();bgImg.src="src/background.jpg";ane=new Ane();fruit=new Fruit();fruit.init();mom=new Mom();mom.init();baby=new Baby();baby.init();data=new Data();wave=new Wave();halo=new Halo();dust=new Dust();dust.init()}function gameloop(){window.requestAnimationFrame(gameloop);var now=Date.now();deltaTime=now-lastTime;lastTime=now;ctx2.drawImage(bgImg,0,0,cavWidth,cavHeight);ane.drawAne();fruit.draw();fruit.fruitMonitor();ctx1.clearRect(0,0,cavWidth,cavHeight);mom.draw();baby.draw();data.draw();momFruitsCollision();momBabyCollision();wave.draw();halo.draw();dust.draw()}function onMouseMove(e){if(!data.gameover){mousex=e.offsetX||e.layerX;mousey=e.offsetY||e.layerX}}
